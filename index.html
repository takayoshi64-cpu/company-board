<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>情報発信掲示板システム</title>
  <style>
    /* ===== テーマ色（安全掲示板ぽい黄色） ===== */
    :root {
      --bg-color: #facc15;         /* ページの背景色（黄） */
      --panel-bg: #facc15;         /* パネル周りも黄に合わせる */
      --card-bg: #ffffff;          /* 箱（カード）の背景 */
      --accent: #111827;           /* 見出しの黒 */
      --accent-soft: #1f2937;      /* 濃いグレー */
      --border: #111827;           /* 枠線（黒っぽく） */
      --text-main: #111827;        /* 文字色（メイン） */
      --text-sub: #4b5563;         /* 文字色（サブ） */
      --badge-green: #16a34a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 16px auto 32px;
      padding: 16px;
    }

    /* ===== ヘッダー ===== */
    header {
      margin-bottom: 12px;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    header p {
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--text-sub);
    }

    /* ===== タブ ===== */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 12px 0 12px;
    }

    .tab {
      border: 1px solid var(--accent);
      background: #fef9c3;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 13px;
      border-radius: 999px;
      color: var(--accent-soft);
    }

    .tab.active {
      background-color: var(--accent);
      color: #ffffff;
    }

    /* ===== パネル共通（フォームと一覧の枠） ===== */
    .panel {
      background-color: var(--panel-bg);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .panel h2 {
      margin: 0;
      font-size: 16px;
      padding: 8px 12px;
      background-color: var(--accent);
      color: #ffffff;
      border-radius: 8px 8px 0 0;
    }

    .panel-body {
      padding: 10px 12px 12px;
      border-radius: 0 0 8px 8px;
    }

    /* ===== 入力フォーム ===== */
    .form-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
    }

    .form-row label {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 2px;
    }

    input[type="text"],
    textarea,
    select {
      font-family: inherit;
      font-size: 13px;
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background-color: #fefce8;
      color: var(--text-main);
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px #fef9c3;
      background-color: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    button {
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background-color: var(--accent);
      color: #ffffff;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
    }

    button:hover {
      background-color: #000000;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.45);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    button.secondary {
      background-color: #ffffff;
      color: var(--accent);
    }

    button.danger {
      border-color: #b91c1c;
      color: #b91c1c;
      background-color: #fee2e2;
    }

    button.danger:hover {
      background-color: #fecaca;
    }

    /* ===== 掲示一覧を「箱」レイアウトにする ===== */
    .list-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 12px;
    }

    .item {
      background-color: var(--card-bg);
      border-radius: 6px;
      border: 2px solid var(--border);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 120px;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      padding: 6px 10px;
      background-color: #111827;
      color: #f9fafb;
    }

    .item-title {
      font-weight: 600;
      font-size: 14px;
    }

    .item-meta {
      font-size: 11px;
      color: #e5e7eb;
      text-align: right;
    }

    .item-body {
      flex: 1;
      padding: 8px 10px 6px;
      font-size: 13px;
      white-space: pre-wrap;
      background-color: #ffffff;
    }

    .item-actions {
      padding: 4px 10px 8px;
      text-align: right;
      background-color: #ffffff;
    }

    .item-actions button {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
    }

    .empty {
      font-size: 13px;
      color: var(--text-sub);
    }

    /* バッジ */
    .badge {
      display: inline-block;
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      margin-right: 4px;
      background-color: #e5e7eb;
      color: #111827;
    }

    .badge-dept-management {
      background-color: #bfdbfe;
      color: #1d4ed8;
    }

    .badge-dept-factory {
      background-color: #bbf7d0;
      color: #15803d;
    }

    .badge-dept-news {
      background-color: #fecaca;
      color: #b91c1c;
    }

    .badge-dept-safety {
      background-color: #fef08a;
      color: #92400e;
    }

    .badge-important {
      border: 1px solid #b91c1c;
      color: #b91c1c;
      background-color: #fee2e2;
    }

    footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-sub);
    }

    @media (max-width: 640px) {
      .page {
        padding: 8px;
        margin: 8px auto 16px;
      }

      header h1 {
        font-size: 22px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>情報発信掲示板システム</h1>
      <p>管理部・製造部・会社ニュース・安全掲示板を「箱」レイアウトで表示（このPC保存版）</p>
    </header>

    <!-- タブ（絞り込み） -->
    <nav class="tabs">
      <button class="tab active" data-filter="all">全体情報</button>
      <button class="tab" data-filter="management">管理部</button>
      <button class="tab" data-filter="factory">製造部</button>
      <button class="tab" data-filter="news">会社ニュース</button>
      <button class="tab" data-filter="safety">安全掲示板</button>
    </nav>

    <!-- 入力パネル -->
    <section class="panel">
      <h2>新しいお知らせを投稿</h2>
      <div class="panel-body">
        <div class="form-row">
          <label for="titleInput">タイトル</label>
          <input
            id="titleInput"
            type="text"
            placeholder="例：安全パトロール日程のお知らせ"
          />
        </div>

        <div class="form-row">
          <label for="deptInput">掲示区分</label>
          <select id="deptInput">
            <option value="management">管理部からのお知らせ</option>
            <option value="factory">製造部からのお知らせ</option>
            <option value="news">会社ニュース</option>
            <option value="safety">安全掲示板</option>
          </select>
        </div>

        <div class="form-row">
          <label for="bodyInput">本文</label>
          <textarea
            id="bodyInput"
            placeholder="掲示内容を入力してください"
          ></textarea>
        </div>

        <div class="form-row">
          <label for="importantInput">重要度</label>
          <select id="importantInput">
            <option value="normal">通常</option>
            <option value="important">重要</option>
          </select>
        </div>

        <div class="form-row">
          <label for="authorInput">投稿者（任意）</label>
          <input id="authorInput" type="text" placeholder="例：安全衛生委員会" />
        </div>

        <div class="button-row">
          <button id="addButton">投稿する</button>
          <button id="clearButton" class="danger">
            このブラウザの掲示をすべて削除
          </button>
        </div>
      </div>
    </section>

    <!-- 一覧パネル -->
    <section class="panel">
      <h2>掲示一覧（タブで絞り込み・新しい順）</h2>
      <div class="panel-body">
        <div id="listContainer" class="list-container">
          <!-- JSで埋まる -->
        </div>
      </div>
    </section>

    <footer>
      ※ 掲示内容は各PCのブラウザ（localStorage）に保存されます。<br />
      ※ 同じURLでも、中身はPCごとに独立します（PC間共有版は別ステップで作成）。
    </footer>
  </div>

  <script>
    // ===== 設定 =====
    const STORAGE_KEY = "public_display_board_v1";

    // DOM参照
    const titleInput = document.getElementById("titleInput");
    const deptInput = document.getElementById("deptInput");
    const bodyInput = document.getElementById("bodyInput");
    const importantInput = document.getElementById("importantInput");
    const authorInput = document.getElementById("authorInput");
    const addButton = document.getElementById("addButton");
    const clearButton = document.getElementById("clearButton");
    const listContainer = document.getElementById("listContainer");
    const tabs = document.querySelectorAll(".tab");

    // データ
    let posts = loadPosts();
    let activeFilter = "all"; // タブの状態
    renderList();

    // ===== イベント =====
    addButton.addEventListener("click", handleAdd);
    clearButton.addEventListener("click", handleClearAll);

    // Ctrl+Enter(or Cmd+Enter) で投稿
    document.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        handleAdd();
      }
    });

    // タブクリックで絞り込み
    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");
        activeFilter = tab.dataset.filter;
        renderList();
      });
    });

    // ===== 関数群 =====
    function handleAdd() {
      const title = titleInput.value.trim();
      const body = bodyInput.value.trim();
      const dept = deptInput.value;
      const important = importantInput.value;
      const author = authorInput.value.trim();

      if (!body) {
        alert("本文を入力してください");
        return;
      }

      const now = new Date();
      const post = {
        id: Date.now(),
        title: title || "（無題）",
        body,
        dept,
        important: important === "important",
        author,
        createdAt: now.toISOString(),
      };

      posts.unshift(post);
      savePosts(posts);
      renderList();
      clearForm();
    }

    function handleClearAll() {
      if (!confirm("このブラウザに保存されている掲示をすべて削除しますか？")) {
        return;
      }
      posts = [];
      savePosts(posts);
      renderList();
    }

    function handleDelete(id) {
      if (!confirm("この掲示を削除しますか？")) return;
      posts = posts.filter((p) => p.id !== id);
      savePosts(posts);
      renderList();
    }

    function loadPosts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function savePosts(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function renderList() {
      listContainer.innerHTML = "";

      // フィルタリング
      let target = posts;
      if (activeFilter !== "all") {
        target = posts.filter((p) => p.dept === activeFilter);
      }

      if (!target.length) {
        const p = document.createElement("p");
        p.className = "empty";
        p.textContent = "このタブに該当する掲示はありません。";
        listContainer.appendChild(p);
        return;
      }

      target.forEach((p) => {
        const item = document.createElement("article");
        item.className = "item";

        const header = document.createElement("div");
        header.className = "item-header";

        const left = document.createElement("div");

        // 部署バッジ
        const deptBadge = document.createElement("span");
        deptBadge.className = "badge " + getDeptBadgeClass(p.dept);
        deptBadge.textContent = getDeptLabel(p.dept);
        left.appendChild(deptBadge);

        // 重要バッジ
        if (p.important) {
          const impBadge = document.createElement("span");
          impBadge.className = "badge badge-important";
          impBadge.textContent = "重要";
          left.appendChild(impBadge);
        }

        const titleSpan = document.createElement("span");
        titleSpan.className = "item-title";
        titleSpan.textContent = p.title;
        left.appendChild(titleSpan);

        const meta = document.createElement("div");
        meta.className = "item-meta";
        meta.innerHTML =
          formatDateTime(p.createdAt) +
          (p.author ? "<br>" + escapeHtml(p.author) : "");

        header.appendChild(left);
        header.appendChild(meta);

        const bodyDiv = document.createElement("div");
        bodyDiv.className = "item-body";
        bodyDiv.textContent = p.body;

        const actions = document.createElement("div");
        actions.className = "item-actions";
        const delBtn = document.createElement("button");
        delBtn.className = "secondary danger";
        delBtn.textContent = "削除";
        delBtn.addEventListener("click", () => handleDelete(p.id));
        actions.appendChild(delBtn);

        item.appendChild(header);
        item.appendChild(bodyDiv);
        item.appendChild(actions);

        listContainer.appendChild(item);
      });
    }

    function clearForm() {
      // タイトルと部署は残すと連投しやすいので本文だけリセット
      bodyInput.value = "";
      importantInput.value = "normal";
      bodyInput.focus();
    }

    function getDeptLabel(dept) {
      switch (dept) {
        case "management":
          return "管理部";
        case "factory":
          return "製造部";
        case "news":
          return "会社ニュース";
        case "safety":
          return "安全掲示板";
        default:
          return "その他";
      }
    }

    function getDeptBadgeClass(dept) {
      switch (dept) {
        case "management":
          return "badge-dept-management";
        case "factory":
          return "badge-dept-factory";
        case "news":
          return "badge-dept-news";
        case "safety":
          return "badge-dept-safety";
        default:
          return "";
      }
    }

    function formatDateTime(iso) {
      const d = new Date(iso);
      if (isNaN(d.getTime())) return "";
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${y}/${m}/${day} ${hh}:${mm}`;
    }

    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }
  </script>
</body>
</html>
