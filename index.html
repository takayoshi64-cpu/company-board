<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>情報発信掲示板システム</title>
  <style>
    /* ===== 基本テーマ（グレー） ===== */
    :root {
      --bg-color: #f3f4f6;         /* ページの背景色 */
      --panel-bg: #ffffff;         /* パネルの背景 */
      --accent: #2563eb;           /* メインの青 */
      --accent-soft: #dbeafe;      /* 薄い青 */
      --border: #d1d5db;           /* 枠線 */
      --text-main: #111827;        /* 文字色（メイン） */
      --text-sub: #6b7280;         /* 文字色（サブ） */
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
    }

    .page {
      max-width: 1000px;
      margin: 16px auto 32px;
      padding: 16px;
    }

    /* ===== ヘッダー ===== */
    header {
      margin-bottom: 12px;
    }

    header h1 {
      margin: 0;
      font-size: 24px;
    }

    header p {
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--text-sub);
    }

    /* ===== タブ ===== */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 8px 0 12px;
      border-bottom: 1px solid var(--border);
    }

    .tab {
      border: none;
      background: transparent;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 13px;
      border-radius: 6px 6px 0 0;
      color: var(--text-sub);
    }

    .tab.active {
      background-color: var(--accent-soft);
      color: var(--accent);
      border: 1px solid var(--border);
      border-bottom-color: var(--bg-color);
    }

    /* ===== パネル共通 ===== */
    .panel {
      background-color: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 14px;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.05);
      margin-bottom: 12px;
    }

    .panel h2 {
      margin: 0 0 8px;
      font-size: 16px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 4px;
    }

    /* ===== 入力フォーム ===== */
    .form-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
    }

    .form-row label {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 2px;
    }

    input[type="text"],
    textarea,
    select {
      font-family: inherit;
      font-size: 13px;
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background-color: #f9fafb;
      color: var(--text-main);
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background-color: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    button {
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background-color: var(--accent);
      color: #ffffff;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
    }

    button:hover {
      background-color: #1d4ed8;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.35);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    button.secondary {
      background-color: #ffffff;
      color: var(--accent);
    }

    button.danger {
      border-color: #b91c1c;
      color: #b91c1c;
      background-color: #fee2e2;
    }

    button.danger:hover {
      background-color: #fecaca;
    }

    /* ===== 通常タブの掲示一覧（縦） ===== */
    .list-container {
      max-height: 480px;
      overflow-y: auto;
    }

    .item {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 0;
    }

    .item:last-child {
      border-bottom: none;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .item-title {
      font-weight: 600;
      font-size: 14px;
    }

    .item-meta {
      font-size: 11px;
      color: var(--text-sub);
      text-align: right;
    }

    .item-body {
      margin-top: 4px;
      font-size: 13px;
      white-space: pre-wrap;
    }

    .item-actions {
      margin-top: 4px;
      text-align: right;
    }

    .item-actions button {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
    }

    .empty {
      font-size: 13px;
      color: var(--text-sub);
    }

    /* バッジ */
    .badge {
      display: inline-block;
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      margin-right: 4px;
    }

    .badge-dept-management {
      background-color: #dbeafe;
      color: #1d4ed8;
    }

    .badge-dept-factory {
      background-color: #dcfce7;
      color: #15803d;
    }

    .badge-dept-news {
      background-color: #fee2e2;
      color: #b91c1c;
    }

    .badge-dept-safety {
      background-color: #fef9c3;
      color: #92400e;
    }

    .badge-important {
      border: 1px solid #b91c1c;
      color: #b91c1c;
      background-color: #fee2e2;
    }

    footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-sub);
    }

    @media (max-width: 640px) {
      .page {
        padding: 8px;
        margin: 8px auto 16px;
      }

      header h1 {
        font-size: 20px;
      }
    }

    /* ============================== */
    /*   ここから「安全タブ」専用見た目   */
    /* ============================== */

    /* 安全タブのときだけ body に safety-mode クラスが付く */
    body.safety-mode {
      background-color: #facc15; /* 全体黄色 */
    }

    body.safety-mode .page {
      max-width: 1100px;
    }

    body.safety-mode header h1,
    body.safety-mode header p {
      color: #111827;
    }

    body.safety-mode .panel.list-panel {
      background-color: #facc15;
      border: none;
      box-shadow: none;
      padding: 0;
    }

    body.safety-mode .panel.list-panel h2 {
      margin: 0;
      padding: 8px 12px;
      background-color: #111827;
      color: #f9fafb;
      border-radius: 8px 8px 0 0;
      border-bottom: 2px solid #111827;
    }

    body.safety-mode .panel.list-panel .list-container {
      max-height: none;
      padding: 10px 12px 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 12px;
    }

    body.safety-mode .safety-card {
      background-color: #ffffff;
      border-radius: 6px;
      border: 2px solid #111827;
      display: flex;
      flex-direction: column;
      min-height: 120px;
    }

    body.safety-mode .safety-card-header {
      padding: 6px 10px;
      background-color: #111827;
      color: #f9fafb;
      font-size: 14px;
      font-weight: 700;
      border-bottom: 1px solid #111827;
    }

    body.safety-mode .safety-card-body {
      flex: 1;
      padding: 8px 10px 6px;
      background-color: #ffffff;
    }

    body.safety-mode .safety-card-body textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      font-family: inherit;
      font-size: 13px;
      padding: 4px 6px;
      resize: vertical;
    }

    body.safety-mode .safety-card-footer {
      padding: 4px 10px 8px;
      text-align: right;
      background-color: #ffffff;
    }

    body.safety-mode .safety-card-footer button {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>情報発信掲示板システム</h1>
      <p>管理部・製造部などの社内連絡をタブで切替（安全タブだけ黄色い箱レイアウト）</p>
    </header>

    <!-- タブ（絞り込み） -->
    <nav class="tabs">
      <button class="tab active" data-filter="all">全体情報</button>
      <button class="tab" data-filter="management">管理部</button>
      <button class="tab" data-filter="factory">製造部</button>
      <button class="tab" data-filter="news">会社ニュース</button>
      <button class="tab" data-filter="safety">安全掲示板</button>
    </nav>

    <!-- 入力パネル -->
    <section class="panel">
      <h2>新しいお知らせを投稿</h2>

      <div class="form-row">
        <label for="titleInput">タイトル</label>
        <input
          id="titleInput"
          type="text"
          placeholder="例：安全パトロール日程のお知らせ"
        />
      </div>

      <div class="form-row">
        <label for="deptInput">部署 / 区分</label>
        <select id="deptInput">
          <option value="management">管理部からのお知らせ</option>
          <option value="factory">製造部からのお知らせ</option>
          <option value="news">会社ニュース</option>
          <option value="safety">安全掲示板（※安全タブの固定欄とは別）</option>
        </select>
      </div>

      <div class="form-row">
        <label for="bodyInput">本文</label>
        <textarea
          id="bodyInput"
          placeholder="掲示内容を入力してください"
        ></textarea>
      </div>

      <div class="form-row">
        <label for="importantInput">重要度</label>
        <select id="importantInput">
          <option value="normal">通常</option>
          <option value="important">重要</option>
        </select>
      </div>

      <div class="form-row">
        <label for="authorInput">投稿者（任意）</label>
        <input id="authorInput" type="text" placeholder="例：安全衛生委員会" />
      </div>

      <div class="button-row">
        <button id="addButton">投稿する</button>
        <button id="clearButton" class="danger">
          このブラウザの掲示をすべて削除
        </button>
      </div>
    </section>

    <!-- 一覧パネル -->
    <section class="panel list-panel">
      <h2>掲示一覧（タブで絞り込み・新しい順）</h2>
      <div id="listContainer" class="list-container">
        <!-- JSで埋まる -->
      </div>
    </section>

    <footer>
      ※ 掲示内容は各PCのブラウザ（localStorage）に保存されます。<br />
      ※ 安全タブの黄色い箱も、このPCごとに保存されます。
    </footer>
  </div>

  <script>
    // ===== 設定 =====
    const STORAGE_KEY = "public_display_board_v1";
    const SAFETY_STORAGE_KEY = "public_display_board_safety_v1";

    // 安全掲示板の固定6ボックス（初期値）
    const DEFAULT_SAFETY_BOXES = [
      { id: "safety_remarks", title: "安全パトロールの指摘事項", body: "" },
      { id: "safety_schedule", title: "安全パトロール日程", body: "" },
      { id: "safety_doctor", title: "産業医工場巡視より", body: "" },
      { id: "safety_record", title: "安全成績（10 月2日～11 月4日まで）", body: "" },
      { id: "safety_overtime", title: "長時間労働と健康障害防止", body: "" },
      { id: "safety_wire", title: "今月のワイヤー点検色", body: "" },
    ];

    // DOM参照
    const titleInput = document.getElementById("titleInput");
    const deptInput = document.getElementById("deptInput");
    const bodyInput = document.getElementById("bodyInput");
    const importantInput = document.getElementById("importantInput");
    const authorInput = document.getElementById("authorInput");
    const addButton = document.getElementById("addButton");
    const clearButton = document.getElementById("clearButton");
    const listContainer = document.getElementById("listContainer");
    const tabs = document.querySelectorAll(".tab");
    const bodyEl = document.body;

    // データ
    let posts = loadPosts();
    let safetyBoxes = loadSafetyBoxes();
    let activeFilter = "all"; // タブの状態

    updateMode();
    renderList();

    // ===== イベント =====
    addButton.addEventListener("click", handleAdd);
    clearButton.addEventListener("click", handleClearAll);

    // Ctrl+Enter(or Cmd+Enter) で投稿
    document.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        handleAdd();
      }
    });

    // タブクリックで絞り込み
    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");
        activeFilter = tab.dataset.filter;
        updateMode();
        renderList();
      });
    });

    // ===== 安全掲示板の保存・読込 =====
    function loadSafetyBoxes() {
      try {
        const raw = localStorage.getItem(SAFETY_STORAGE_KEY);
        if (!raw) return DEFAULT_SAFETY_BOXES.slice();
        const parsed = JSON.parse(raw);
        // もしボックス数が変わった場合に備えて、IDでマージ
        const map = new Map(parsed.map((b) => [b.id, b]));
        return DEFAULT_SAFETY_BOXES.map((b) =>
          map.has(b.id) ? { ...b, body: map.get(b.id).body || "" } : b
        );
      } catch (e) {
        console.error(e);
        return DEFAULT_SAFETY_BOXES.slice();
      }
    }

    function saveSafetyBoxes() {
      localStorage.setItem(SAFETY_STORAGE_KEY, JSON.stringify(safetyBoxes));
    }

    function updateSafetyBox(id, newBody) {
      const box = safetyBoxes.find((b) => b.id === id);
      if (!box) return;
      box.body = newBody;
      saveSafetyBoxes();
    }

    // ===== 通常掲示の保存・読込 =====
    function loadPosts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function savePosts(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // ===== 表示切替 =====
    function updateMode() {
      // 安全タブのときだけ黄色い安全掲示板モード
      if (activeFilter === "safety") {
        bodyEl.classList.add("safety-mode");
      } else {
        bodyEl.classList.remove("safety-mode");
      }
    }

    // ===== イベント処理 =====
    function handleAdd() {
      const title = titleInput.value.trim();
      const body = bodyInput.value.trim();
      const dept = deptInput.value;
      const important = importantInput.value;
      const author = authorInput.value.trim();

      if (!body) {
        alert("本文を入力してください");
        return;
      }

      const now = new Date();
      const post = {
        id: Date.now(),
        title: title || "（無題）",
        body,
        dept,
        important: important === "important",
        author,
        createdAt: now.toISOString(),
      };

      posts.unshift(post);
      savePosts(posts);
      renderList();
      clearForm();
    }

    function handleClearAll() {
      if (!confirm("このブラウザに保存されている掲示をすべて削除しますか？（安全タブの固定欄は消えません）」")) {
        return;
      }
      posts = [];
      savePosts(posts);
      renderList();
    }

    function handleDelete(id) {
      if (!confirm("この掲示を削除しますか？")) return;
      posts = posts.filter((p) => p.id !== id);
      savePosts(posts);
      renderList();
    }

    // ===== 描画 =====
    function renderList() {
      listContainer.innerHTML = "";

      // 安全タブは固定6箱を表示
      if (activeFilter === "safety") {
        renderSafetyBoxes();
        return;
      }

      // 通常タブ（全体・管理・製造・ニュース）
      let target = posts;
      if (activeFilter !== "all") {
        target = posts.filter((p) => p.dept === activeFilter);
      }

      if (!target.length) {
        const p = document.createElement("p");
        p.className = "empty";
        p.textContent = "このタブに該当する掲示はありません。";
        listContainer.appendChild(p);
        return;
      }

      target.forEach((p) => {
        const item = document.createElement("article");
        item.className = "item";

        const header = document.createElement("div");
        header.className = "item-header";

        const left = document.createElement("div");

        // 部署バッジ
        const deptBadge = document.createElement("span");
        deptBadge.className = "badge " + getDeptBadgeClass(p.dept);
        deptBadge.textContent = getDeptLabel(p.dept);
        left.appendChild(deptBadge);

        // 重要バッジ
        if (p.important) {
          const impBadge = document.createElement("span");
          impBadge.className = "badge badge-important";
          impBadge.textContent = "重要";
          left.appendChild(impBadge);
        }

        const titleSpan = document.createElement("span");
        titleSpan.className = "item-title";
        titleSpan.textContent = p.title;
        left.appendChild(titleSpan);

        const meta = document.createElement("div");
        meta.className = "item-meta";
        meta.innerHTML =
          formatDateTime(p.createdAt) +
          (p.author ? "<br>" + escapeHtml(p.author) : "");

        header.appendChild(left);
        header.appendChild(meta);

        const bodyDiv = document.createElement("div");
        bodyDiv.className = "item-body";
        bodyDiv.textContent = p.body;

        const actions = document.createElement("div");
        actions.className = "item-actions";
        const delBtn = document.createElement("button");
        delBtn.className = "secondary danger";
        delBtn.textContent = "削除";
        delBtn.addEventListener("click", () => handleDelete(p.id));
        actions.appendChild(delBtn);

        item.appendChild(header);
        item.appendChild(bodyDiv);
        item.appendChild(actions);

        listContainer.appendChild(item);
      });
    }

    function renderSafetyBoxes() {
      safetyBoxes.forEach((box) => {
        const wrap = document.createElement("article");
        wrap.className = "safety-card";

        const header = document.createElement("div");
        header.className = "safety-card-header";
        header.textContent = box.title;

        const body = document.createElement("div");
        body.className = "safety-card-body";
        const textarea = document.createElement("textarea");
        textarea.value = box.body || "";
        textarea.addEventListener("change", () => {
          updateSafetyBox(box.id, textarea.value);
        });
        body.appendChild(textarea);

        const footer = document.createElement("div");
        footer.className = "safety-card-footer";
        const saveBtn = document.createElement("button");
        saveBtn.className = "secondary";
        saveBtn.textContent = "保存";
        saveBtn.addEventListener("click", () => {
          updateSafetyBox(box.id, textarea.value);
          alert("保存しました");
        });
        footer.appendChild(saveBtn);

        wrap.appendChild(header);
        wrap.appendChild(body);
        wrap.appendChild(footer);

        listContainer.appendChild(wrap);
      });
    }

    // ===== ユーティリティ =====
    function clearForm() {
      bodyInput.value = "";
      importantInput.value = "normal";
      bodyInput.focus();
    }

    function getDeptLabel(dept) {
      switch (dept) {
        case "management":
          return "管理部";
        case "factory":
          return "製造部";
        case "news":
          return "会社ニュース";
        case "safety":
          return "安全掲示板";
        default:
          return "その他";
      }
    }

    function getDeptBadgeClass(dept) {
      switch (dept) {
        case "management":
          return "badge-dept-management";
        case "factory":
          return "badge-dept-factory";
        case "news":
          return "badge-dept-news";
        case "safety":
          return "badge-dept-safety";
        default:
          return "";
      }
    }

    function formatDateTime(iso) {
      const d = new Date(iso);
      if (isNaN(d.getTime())) return "";
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${y}/${m}/${day} ${hh}:${mm}`;
    }

    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }
  </script>
</body>
</html>
